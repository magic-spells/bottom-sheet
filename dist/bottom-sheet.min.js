!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).BottomSheet={})}(this,function(e){"use strict";const t=(e,t)=>{let n;return function(...o){n||(e.apply(this,o),n=!0,setTimeout(()=>n=!1,t))}};class BottomSheet extends HTMLElement{#e={};#t={};#n=.1;#o=100;#s=1/0;#i=null;#a=null;#r=!1;static get observedAttributes(){return["max-display-width"]}attributeChangedCallback(e,t,n){const o=this;if(t!==n&&"max-display-width"===e)if(null===n||"none"===n)o.maxDisplayWidth=1/0;else{const e=parseInt(n);o.maxDisplayWidth=isNaN(e)?1/0:e}}get maxDisplayWidth(){return this.#s}set maxDisplayWidth(e){const t=this;t.#s=e,e===1/0?t.removeAttribute("max-display-width"):t.setAttribute("max-display-width",e)}get panel(){return this.closest("dialog-panel")}get dialog(){return this.closest("dialog")}get header(){return this.querySelector("bottom-sheet-header")}get content(){return this.querySelector("bottom-sheet-content")}get backdrop(){return this.panel?.querySelector("dialog-backdrop")}constructor(){super();const e=this;e.#t={isDragging:!1,startY:0,currentY:0,delta:0,direction:null,isHeader:!1,isBackdrop:!1,isAtTop:!1},e.#e={touchStart:e.#d.bind(e),touchMove:e.#l.bind(e),touchEnd:e.#c.bind(e),transitionEnd:e.#h.bind(e),windowResize:t(()=>{window.innerWidth>e.maxDisplayWidth&&e.panel?.isOpen&&e.hide()},100),beforeShow:()=>{const t=e.backdrop;t&&!e.#r&&(e.#u(t),e.#r=!0),e.dialog?.classList.add("transitioning")}}}show(e){window.innerWidth>this.maxDisplayWidth||this.panel?.show(e)}hide(){this.dialog&&(this.dialog.style.transform=""),this.panel?.hide()}#u(e){const t=this;e&&(e.addEventListener("touchstart",t.#e.touchStart,{capture:!0}),e.addEventListener("touchmove",t.#e.touchMove,{passive:!1}),e.addEventListener("touchend",t.#e.touchEnd),e.addEventListener("touchcancel",t.#e.touchEnd))}#p(e){const t=this;e&&(e.removeEventListener("touchstart",t.#e.touchStart,{capture:!0}),e.removeEventListener("touchmove",t.#e.touchMove,{passive:!1}),e.removeEventListener("touchend",t.#e.touchEnd),e.removeEventListener("touchcancel",t.#e.touchEnd))}connectedCallback(){const e=this;e.#i=e.panel,e.#a=e.dialog,window.addEventListener("resize",e.#e.windowResize),e.#u(e.header),e.#u(e.content),e.#r=!1,e.#i?.addEventListener("beforeShow",e.#e.beforeShow),e.#a&&e.#a.addEventListener("transitionend",e.#e.transitionEnd)}disconnectedCallback(){const e=this;window.removeEventListener("resize",e.#e.windowResize),e.#p(e.header),e.#p(e.content),e.#r&&(e.#p(e.#i?.querySelector("dialog-backdrop")),e.#r=!1),e.#i?.removeEventListener("beforeShow",e.#e.beforeShow),e.#a&&e.#a.removeEventListener("transitionend",e.#e.transitionEnd),e.#i=null,e.#a=null}#d(e){const t=this,n=t.#t;n.startY=e.targetTouches[0].screenY,n.direction=null,n.delta=0,t.dialog?.classList.remove("transitioning");const o=!!e.target.closest("bottom-sheet-header"),s=!!e.target.closest("dialog-backdrop"),i=0===t.content?.scrollTop;n.isHeader=o,n.isBackdrop=s,n.isAtTop=i,(o||s||i)&&(n.isDragging=!0)}#g(e){return 10*Math.sqrt(e)*this.#n}#l(e){const t=this,n=t.#t;if(!n.isDragging)return;if(n.currentY=e.targetTouches[0].screenY,n.delta=n.currentY-n.startY,n.direction||(n.direction=n.delta<0?"up":"down"),!n.isHeader&&!n.isBackdrop){if(!n.isAtTop)return;if("up"===n.direction)return}e.cancelable&&e.preventDefault(),e.stopPropagation();const o=t.dialog;if(o){if(n.delta<0){const e=t.#g(Math.abs(n.delta));return void(o.style.transform=`translate3d(0,${-e}px,0)`)}n.delta>0&&(o.style.transform=`translate3d(0,${n.delta}px,0)`)}}#c(){const e=this,t=e.#t;if(!t.isDragging)return;t.isDragging=!1;const n=e.dialog;if(n)if(0!==t.delta){if(n.classList.add("transitioning"),t.delta<0)return t.delta=0,t.direction=null,void(n.style.transform="");if(t.delta>e.#o)return t.delta=0,t.direction=null,void e.hide();t.delta=0,t.direction=null,n.style.transform=""}else t.direction=null}#h(e){e.target===this.dialog&&"transform"===e.propertyName&&this.dialog.classList.remove("transitioning")}}class BottomSheetContent extends HTMLElement{constructor(){super()}}class BottomSheetHeader extends HTMLElement{constructor(){super()}}customElements.get("bottom-sheet")||customElements.define("bottom-sheet",BottomSheet),customElements.get("bottom-sheet-content")||customElements.define("bottom-sheet-content",BottomSheetContent),customElements.get("bottom-sheet-header")||customElements.define("bottom-sheet-header",BottomSheetHeader),e.BottomSheet=BottomSheet,e.BottomSheetContent=BottomSheetContent,e.BottomSheetHeader=BottomSheetHeader});
